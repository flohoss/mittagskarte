services:
  backend:
    build:
      context: .
      dockerfile: ./docker/Dockerfile.dev
      args:
        - V_GOLANG=${V_GOLANG}
    command: air -c .air.toml
    environment:
      - TZ=Europe/Berlin
      - LOG_LEVEL=debug
    ports:
      - 4000:4000
    volumes:
      - .:/app/

  frontend:
    image: node:${V_NODE}
    working_dir: /app/web
    command: yarn dev --host
    ports:
      - 9000:9000
    volumes:
      - .:/app/

  mittag:
    profiles: [ build ]
    image: ${CURRENT_IMAGE}
    build:
      context: .
      dockerfile: ./docker/Dockerfile
      args:
        - V_GOLANG=${V_GOLANG}
        - V_DEBIAN=${V_DEBIAN}
        - V_NODE=${V_NODE}
        - V_ALPINE=${V_ALPINE}
        - APP_VERSION=${CI_COMMIT_TAG}

  golang:
    profiles: [ install ]
    image: golang:${V_GOLANG}
    working_dir: /app
    volumes:
      - .:/app/

  node:
    profiles: [ install ]
    image: node:${V_NODE}
    working_dir: /app/web
    volumes:
      - .:/app/
