{{ define "title" }}
  {{ .Title }}
{{ end }}

{{ define "content" }}
  {{ $restDay := isRestDay .Restaurant }}
  {{ if $restDay }}
    <div class="absolute w-full h-full top-0 left-0 z-40"></div>
    <div class="z-50 -rotate-12 absolute top-24 left-1/2 transform -translate-x-1/2">
      <div class="alert alert-warning shadow-lg">
        <div>
          <svg class="icon"><use href="#info"></use></svg>
          <span>Heute kein Mittagstisch</span>
        </div>
      </div>
    </div>
  {{ end }}
  <div class="{{ if $restDay }}grayscale opacity-50 animate-fadeIn50{{ else }}animate-fadeIn{{ end }} container-custom">
    <div class="flex flex-col items-center gap-5">
      <div class="mt-10 relative w-full max-w-4xl h-[150px]">
        <div class="absolute inset-0 rounded-xl bg-cover bg-center" style="background-image: url('/static/downloads/{{ .Restaurant.ID }}/map.webp')"></div>
        <div class="bg-primary text-primary-content rounded-xl px-3 py-2 absolute -top-8 left-1/2 transform -translate-x-1/2 text-3xl md:text-4xl">
          {{ .Restaurant.Name }}
        </div>
        <div
          class="whitespace-nowrap overflow-hidden bg-base-200 text-base-content rounded-b-lg py-1 absolute inset-x-0 bottom-0 flex items-center gap-1 justify-center text-xs"
        >
          <div>{{ .Restaurant.Street }}</div>
          <div>{{ .Restaurant.StreetNumber }},</div>
          <div>{{ .Restaurant.ZipCode }}</div>
          <div class="truncate">{{ .Restaurant.City }}</div>
        </div>
      </div>

      <div class="flex flex-col gap-1 items-center">
        <div class="flex justify-center gap-1">
          {{ if .Restaurant.Card.ImageURL }}
            <label for="my-modal" class="btn btn-sm btn-primary gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 512 512">
                <path
                  d="M0 96C0 60.7 28.7 32 64 32H448c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4s12.4 13.6 21.6 13.6h96 32H424c8.9 0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"
                />
              </svg>
              Speisekarte
            </label>
          {{ end }}
          <a target="_blank" class="btn btn-sm btn-secondary gap-2" href="{{ .Restaurant.PageURL }}">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 512 512">
              <path
                d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"
              />
            </svg>
            Webseite
          </a>
        </div>

        <a href="tel:{{ .Restaurant.Phone }}" class="btn btn-sm gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-xs" fill="currentColor" viewBox="0 0 512 512">
            <path
              d="M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"
            />
          </svg>
          {{ .Restaurant.Phone }}
        </a>
      </div>

      <div class="text-xl font-bold">{{ .Restaurant.Card.Description }}</div>

      <div class="w-full max-w-4xl grid gap-4">
        {{ range .Restaurant.Card.Food }}
          {{ $today := isToday . }}
          {{ $notRestDay := not $restDay }}
          <div class="{{ if and $today $notRestDay }}food-card{{ else }}food-card-disabled{{ end }}">
            <div>
              {{ if .Day }}<div class="text-sm">{{ .Day }}</div>{{ end }}
              <div class="font-bold text-lg">{{ .Name }}</div>
              {{ if .Description }}<div class="text-sm">{{ .Description }}</div>{{ end }}
            </div>
            {{ $price := printf "%.2f" .Price }}
            {{ $price := $price | replace "." "," }}
            <div class="price badge badge-lg badge-primary whitespace-nowrap">{{ $price }} €</div>
          </div>
        {{ end }}
      </div>

      <div class="text-xs text-gray-500">Aktualisiert: {{ .Restaurant.Card.CreatedAt | date "02.01.06 15:04" }}</div>
    </div>
  </div>
{{ end }}

{{ define "modal" }}
  {{ if .Restaurant.Card.ImageURL }}
    {{ $sizes := imageSize .Restaurant.Card.ImageURL }}
    {{ $height := index $sizes 0 }}
    {{ $width := index $sizes 1 }}
    {{ $imgSize := printf "width='%d' height='%d'" $width $height }}
    <label class="hidden" for="my-modal">Restaurant-Menu</label>
    <input type="checkbox" id="my-modal" class="modal-toggle" />
    <label for="my-modal" class="modal modal-bottom sm:modal-middle cursor-pointer">
      <label class="modal-box p-2 relative">
        <img {{ $imgSize }} class="rounded-xl" src="/{{ .Restaurant.Card.ImageURL }}" />
      </label>
    </label>
  {{ end }}
{{ end }}

{{ define "js" }}
  <script>
    const SETTINGS_LOCAL_STORAGE = "mittag_settings";

    let priceReduction = 0;
    const prices = document.querySelectorAll(".price");
    const ls = localStorage.getItem(SETTINGS_LOCAL_STORAGE);
    if (ls) {
      const parsed = JSON.parse(ls);
      priceAdjustment = parsed.priceAdjustment;
      for (price of prices) {
        const parsedPrice = parseFloat(price.innerText.replace(",", "."));
        price.innerText = (parsedPrice - priceAdjustment).toFixed(2).replace(".", ",") + " €";
      }
    }
  </script>
{{ end }}
