ARG V_GOLANG
ARG V_GOLANG='latest'
FROM --platform=linux/amd64 golang:${V_GOLANG} AS golang
FROM --platform=linux/amd64 mcr.microsoft.com/playwright:v1.47.2-noble AS final
WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
    apt-transport-https ca-certificates curl gnupg libmagickwand-dev libmagickcore-dev imagemagick libmupdf-dev && \
    apt-get autoremove -y && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

COPY --from=golang /usr/local/go/ /usr/local/go/
ENV PATH="/usr/local/go/bin:/root/go/bin:${PATH}"

RUN go install github.com/air-verse/air@latest
RUN go install github.com/swaggo/swag/cmd/swag@latest

COPY ./go.mod .
COPY ./go.sum .
RUN go mod download
